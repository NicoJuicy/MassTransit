<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQ | MassTransit</title>
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    
    
    <link rel="preload" href="/MassTransit/assets/css/0.styles.e9548384.css" as="style"><link rel="preload" href="/MassTransit/assets/js/app.507829b3.js" as="script"><link rel="preload" href="/MassTransit/assets/js/6.b9c46cbe.js" as="script"><link rel="preload" href="/MassTransit/assets/js/1.f2cfa088.js" as="script"><link rel="preload" href="/MassTransit/assets/js/110.525aec89.js" as="script"><link rel="prefetch" href="/MassTransit/assets/js/10.8a53d3c6.js"><link rel="prefetch" href="/MassTransit/assets/js/100.dea5063d.js"><link rel="prefetch" href="/MassTransit/assets/js/101.fdf33797.js"><link rel="prefetch" href="/MassTransit/assets/js/102.08802a09.js"><link rel="prefetch" href="/MassTransit/assets/js/103.94dfe6b2.js"><link rel="prefetch" href="/MassTransit/assets/js/104.a2200f50.js"><link rel="prefetch" href="/MassTransit/assets/js/105.f38fb744.js"><link rel="prefetch" href="/MassTransit/assets/js/106.9f4944a0.js"><link rel="prefetch" href="/MassTransit/assets/js/107.29628318.js"><link rel="prefetch" href="/MassTransit/assets/js/108.dd7f1d58.js"><link rel="prefetch" href="/MassTransit/assets/js/109.876d62e4.js"><link rel="prefetch" href="/MassTransit/assets/js/11.489768a6.js"><link rel="prefetch" href="/MassTransit/assets/js/111.5d7c6cef.js"><link rel="prefetch" href="/MassTransit/assets/js/12.c2c0c52b.js"><link rel="prefetch" href="/MassTransit/assets/js/13.de967d55.js"><link rel="prefetch" href="/MassTransit/assets/js/14.80f79d01.js"><link rel="prefetch" href="/MassTransit/assets/js/15.f0ec9a0d.js"><link rel="prefetch" href="/MassTransit/assets/js/16.07e33012.js"><link rel="prefetch" href="/MassTransit/assets/js/17.a5458ce9.js"><link rel="prefetch" href="/MassTransit/assets/js/18.d0709395.js"><link rel="prefetch" href="/MassTransit/assets/js/19.d6ea4de4.js"><link rel="prefetch" href="/MassTransit/assets/js/20.6f83da94.js"><link rel="prefetch" href="/MassTransit/assets/js/21.394a4a17.js"><link rel="prefetch" href="/MassTransit/assets/js/22.d356c42c.js"><link rel="prefetch" href="/MassTransit/assets/js/23.803d54aa.js"><link rel="prefetch" href="/MassTransit/assets/js/24.7926c825.js"><link rel="prefetch" href="/MassTransit/assets/js/25.53cfecab.js"><link rel="prefetch" href="/MassTransit/assets/js/26.08518995.js"><link rel="prefetch" href="/MassTransit/assets/js/27.c45a4e89.js"><link rel="prefetch" href="/MassTransit/assets/js/28.216d09b3.js"><link rel="prefetch" href="/MassTransit/assets/js/29.d80bacb6.js"><link rel="prefetch" href="/MassTransit/assets/js/30.cdc44409.js"><link rel="prefetch" href="/MassTransit/assets/js/31.f476159a.js"><link rel="prefetch" href="/MassTransit/assets/js/32.31b6eefe.js"><link rel="prefetch" href="/MassTransit/assets/js/33.79798b43.js"><link rel="prefetch" href="/MassTransit/assets/js/34.cc04befa.js"><link rel="prefetch" href="/MassTransit/assets/js/35.f29df75f.js"><link rel="prefetch" href="/MassTransit/assets/js/36.e9d6cc6d.js"><link rel="prefetch" href="/MassTransit/assets/js/37.dd12c8f5.js"><link rel="prefetch" href="/MassTransit/assets/js/38.31ac2f25.js"><link rel="prefetch" href="/MassTransit/assets/js/39.7124ee1f.js"><link rel="prefetch" href="/MassTransit/assets/js/4.6ac43b74.js"><link rel="prefetch" href="/MassTransit/assets/js/40.eefd40da.js"><link rel="prefetch" href="/MassTransit/assets/js/41.33aebd66.js"><link rel="prefetch" href="/MassTransit/assets/js/42.b885c43e.js"><link rel="prefetch" href="/MassTransit/assets/js/43.ebbd1e2a.js"><link rel="prefetch" href="/MassTransit/assets/js/44.f87ec852.js"><link rel="prefetch" href="/MassTransit/assets/js/45.53e426f0.js"><link rel="prefetch" href="/MassTransit/assets/js/46.21f60550.js"><link rel="prefetch" href="/MassTransit/assets/js/47.85684ee0.js"><link rel="prefetch" href="/MassTransit/assets/js/48.904c9b27.js"><link rel="prefetch" href="/MassTransit/assets/js/49.2ef354b5.js"><link rel="prefetch" href="/MassTransit/assets/js/5.413cd6be.js"><link rel="prefetch" href="/MassTransit/assets/js/50.54704214.js"><link rel="prefetch" href="/MassTransit/assets/js/51.4cc1c6f9.js"><link rel="prefetch" href="/MassTransit/assets/js/52.a945a897.js"><link rel="prefetch" href="/MassTransit/assets/js/53.2372d01e.js"><link rel="prefetch" href="/MassTransit/assets/js/54.d69d0b89.js"><link rel="prefetch" href="/MassTransit/assets/js/55.ee9680f6.js"><link rel="prefetch" href="/MassTransit/assets/js/56.ffd754c3.js"><link rel="prefetch" href="/MassTransit/assets/js/57.116a2a32.js"><link rel="prefetch" href="/MassTransit/assets/js/58.d3335fc9.js"><link rel="prefetch" href="/MassTransit/assets/js/59.7b8d567a.js"><link rel="prefetch" href="/MassTransit/assets/js/60.0e44b996.js"><link rel="prefetch" href="/MassTransit/assets/js/61.4e20793d.js"><link rel="prefetch" href="/MassTransit/assets/js/62.bcf0b140.js"><link rel="prefetch" href="/MassTransit/assets/js/63.52ae8ff6.js"><link rel="prefetch" href="/MassTransit/assets/js/64.819c10c7.js"><link rel="prefetch" href="/MassTransit/assets/js/65.3682be0f.js"><link rel="prefetch" href="/MassTransit/assets/js/66.5e442452.js"><link rel="prefetch" href="/MassTransit/assets/js/67.f0901a9e.js"><link rel="prefetch" href="/MassTransit/assets/js/68.edf45a54.js"><link rel="prefetch" href="/MassTransit/assets/js/69.0691d2ff.js"><link rel="prefetch" href="/MassTransit/assets/js/7.8a51af61.js"><link rel="prefetch" href="/MassTransit/assets/js/70.8e280419.js"><link rel="prefetch" href="/MassTransit/assets/js/71.d655551b.js"><link rel="prefetch" href="/MassTransit/assets/js/72.9f171999.js"><link rel="prefetch" href="/MassTransit/assets/js/73.38a47796.js"><link rel="prefetch" href="/MassTransit/assets/js/74.1753e133.js"><link rel="prefetch" href="/MassTransit/assets/js/75.28f9b3e6.js"><link rel="prefetch" href="/MassTransit/assets/js/76.6dbd3b9e.js"><link rel="prefetch" href="/MassTransit/assets/js/77.7e7a6a46.js"><link rel="prefetch" href="/MassTransit/assets/js/78.f603b82b.js"><link rel="prefetch" href="/MassTransit/assets/js/79.5cee3c98.js"><link rel="prefetch" href="/MassTransit/assets/js/8.6b741284.js"><link rel="prefetch" href="/MassTransit/assets/js/80.6aefc97d.js"><link rel="prefetch" href="/MassTransit/assets/js/81.dcaa7545.js"><link rel="prefetch" href="/MassTransit/assets/js/82.4f71f3b3.js"><link rel="prefetch" href="/MassTransit/assets/js/83.602dc14d.js"><link rel="prefetch" href="/MassTransit/assets/js/84.b2e3702c.js"><link rel="prefetch" href="/MassTransit/assets/js/85.55a4f6af.js"><link rel="prefetch" href="/MassTransit/assets/js/86.f75a06f2.js"><link rel="prefetch" href="/MassTransit/assets/js/87.efc02065.js"><link rel="prefetch" href="/MassTransit/assets/js/88.60fb1dd8.js"><link rel="prefetch" href="/MassTransit/assets/js/89.5dc2cfdb.js"><link rel="prefetch" href="/MassTransit/assets/js/9.9f129a0e.js"><link rel="prefetch" href="/MassTransit/assets/js/90.c3da6b52.js"><link rel="prefetch" href="/MassTransit/assets/js/91.4f25ae4d.js"><link rel="prefetch" href="/MassTransit/assets/js/92.ff3a8464.js"><link rel="prefetch" href="/MassTransit/assets/js/93.26d099c6.js"><link rel="prefetch" href="/MassTransit/assets/js/94.395a5fdd.js"><link rel="prefetch" href="/MassTransit/assets/js/95.885d64a6.js"><link rel="prefetch" href="/MassTransit/assets/js/96.438fc819.js"><link rel="prefetch" href="/MassTransit/assets/js/97.acde79bf.js"><link rel="prefetch" href="/MassTransit/assets/js/98.6add9580.js"><link rel="prefetch" href="/MassTransit/assets/js/99.d7afcafc.js"><link rel="prefetch" href="/MassTransit/assets/js/vuejs-paginate.55199f2c.js">
    <link rel="stylesheet" href="/MassTransit/assets/css/0.styles.e9548384.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/MassTransit/" class="home-link router-link-active"><img src="/MassTransit/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/MassTransit/updates/" class="nav-link">Blog</a></div><div class="nav-item"><a href="https://gitter.im/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/MassTransit/updates/" class="nav-link">Blog</a></div><div class="nav-item"><a href="https://gitter.im/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/MassTransit/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/MassTransit/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/MassTransit/usage/" class="sidebar-heading clickable router-link-active open"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/MassTransit/usage/configuration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/MassTransit/usage/transports/" class="sidebar-heading clickable router-link-active open"><span>Transports</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/MassTransit/usage/transports/rabbitmq.html" class="active sidebar-link">RabbitMQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MassTransit/usage/transports/rabbitmq.html#cloudamqp" class="sidebar-link">CloudAMQP</a></li><li class="sidebar-sub-header"><a href="/MassTransit/usage/transports/rabbitmq.html#publishing-a-message" class="sidebar-link">Publishing a message</a></li><li class="sidebar-sub-header"><a href="/MassTransit/usage/transports/rabbitmq.html#queues" class="sidebar-link">Queues</a></li><li class="sidebar-sub-header"><a href="/MassTransit/usage/transports/rabbitmq.html#design-benefits" class="sidebar-link">Design Benefits</a></li><li class="sidebar-sub-header"><a href="/MassTransit/usage/transports/rabbitmq.html#faq" class="sidebar-link">Faq</a></li></ul></li><li><a href="/MassTransit/usage/transports/azure-sb.html" class="sidebar-link">Azure Service Bus</a></li><li><a href="/MassTransit/usage/transports/activemq.html" class="sidebar-link">ActiveMQ</a></li><li><a href="/MassTransit/usage/transports/amazonsqs.html" class="sidebar-link">Amazon SQS</a></li><li><a href="/MassTransit/usage/transports/in-memory.html" class="sidebar-link">In Memory</a></li></ul></section></li><li><a href="/MassTransit/usage/messages.html" class="sidebar-link">Messages</a></li><li><a href="/MassTransit/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/MassTransit/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/MassTransit/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/MassTransit/usage/requests.html" class="sidebar-link">Requests</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/MassTransit/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/MassTransit/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/MassTransit/usage/testing.html" class="sidebar-link">Testing</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/MassTransit/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rabbitmq"><a href="#rabbitmq" class="header-anchor">#</a> RabbitMQ</h1> <p>This is the recommended approach for configuring MassTransit for use with RabbitMQ.</p> <p>The code below configures one bus instance and one host with the specified base address. This bus instance can be used to send and publish messages.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    cfg<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;rabbitmq://a-machine-name/a-virtual-host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> host <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        host<span class="token punctuation">.</span><span class="token function">Username</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        host<span class="token punctuation">.</span><span class="token function">Password</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In order to consume messages, you must configure one or more receive endpoints. To do this, include the endpoint configuration inside the configuration delegate:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">namespace</span> MyApplication
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMessage</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMessageConsumer</span> <span class="token punctuation">:</span>
        <span class="token class-name">IConsumer</span><span class="token operator">&lt;</span>MyMessage<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>MyMessage<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>            
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// configured in Program.cs, or wherever</span>
    cfg<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;virtual-host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;queue-name&quot;</span><span class="token punctuation">,</span> ec <span class="token operator">=&gt;</span> 
    <span class="token punctuation">{</span>
        <span class="token comment">// for example, MyMessageConsumer consumes MyMessage</span>
        ec<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Consumer</span><span class="token punctuation">&lt;</span><span class="token class-name">MyMessageConsumer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>RabbitMQ transport will then set up necessary infrastructure elements, such as:</p> <ul><li>Endpoint queue <code>queue-name</code></li> <li>Endpoint exchange <code>queue-name</code></li> <li>Message type exchange <code>MyApplication.MyMessage</code></li> <li>Binding between <code>MyApplication.MyMessage</code>and <code>queue-name</code> exchanges</li> <li>Binding between <code>queue-name</code> exchange and <code>queue-name</code> queue</li></ul> <p>This will result in all messages that will be published to the <code>MyMessage</code> exchange to be also delivered to the <code>queue-name</code> queue.</p> <p>When a message is published, the following happens under the hood:</p> <ul><li>Application calls <em>Publish</em> passing <em>MyMessage</em>.</li> <li>MassTransit serializes the message and sends it to the <code>MyApplication.MyMessage</code> exchange</li> <li>RabbitMQ routes the message to the <code>queue-name</code> exchange</li> <li>RabbitMQ delivers the message to the <code>queue-name</code> queue</li></ul> <p>The infrastructure elements are only created if they do not exist yet. All elements are by default durable. MassTransit will also create a number of elements that are not durable and these will be removed as soon as the service stops. By default, <em>Fanout</em> exchanges are used.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If a message is published prior to starting the receive endpoint (which configures the broker topology), the exchange
<i>MyApplication.MyMessage</i> will be created by <em>Publish</em>. However, it won't be bound to anything until the receive endpoint is started.
Until the message exchange is bound, published messages will just disappear.</p></div> <p>All durable elements remain running on RabbitMQ and this means that even if the service is down and not consuming messages, messages will still be accumulated in the queue so when the service comes online, all queued messages will be consumed.</p> <p>There are additional configuration options for RabbitMQ transport, that can be applied when the bus is being configured:</p> <table><thead><tr><th>Level</th> <th>Property</th> <th>Type</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td>Bus</td> <td><code>PrefetchCount</code></td> <td><code>ushort</code></td> <td>Processor count multiplied by 4</td> <td>The number of messages to fetch in the buffer</td></tr> <tr><td>Bus</td> <td><code>PurgeOnStartup</code></td> <td><code>bool</code></td> <td><code>false</code></td> <td>Forces the bus to clean up messages from the queue when starting</td></tr> <tr><td>Host</td> <td><code>Username</code></td> <td><code>string</code></td> <td></td> <td>User name for RabbitMQ</td></tr> <tr><td>Host</td> <td><code>Password</code></td> <td><code>string</code></td> <td></td> <td>Password for RabbitMQ</td></tr> <tr><td>Host</td> <td><code>ClusterMembers</code></td> <td><code>string[]</code></td> <td></td> <td>List of cluster member addresses</td></tr> <tr><td>Host</td> <td><code>PublisherConfirmation</code></td> <td><code>bool</code></td> <td><code>true</code></td> <td>instructs if MassTransit should wait for a confirmation when publishing or sending messages.</td></tr></tbody></table> <h2 id="cloudamqp"><a href="#cloudamqp" class="header-anchor">#</a> CloudAMQP</h2> <p>MassTransit works great with CloudAMQP, and is an easy way to get started. It's highly recommended to use SSL, an example configuration is shown below. Note that the port number <em>may</em> need to be specified, in addition to the <code>UseSsl</code> configuration.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> host <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;rabbitmq://wombat.rmq.cloudamqp.com:5671/your_vhost/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> h <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        h<span class="token punctuation">.</span><span class="token function">Username</span><span class="token punctuation">(</span><span class="token string">&quot;your_username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        h<span class="token punctuation">.</span><span class="token function">Password</span><span class="token punctuation">(</span><span class="token string">&quot;your_password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        h<span class="token punctuation">.</span><span class="token function">UseSsl</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            s<span class="token punctuation">.</span>Protocol <span class="token operator">=</span> SslProtocols<span class="token punctuation">.</span>Tls12<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="publishing-a-message"><a href="#publishing-a-message" class="header-anchor">#</a> Publishing a message</h2> <p>When you publish a message on the bus here is what happens:</p> <ul><li>Publish <code>MySystem.Messages.SomeMessage</code></li> <li>This message gets published by the publishing logic to the exchange <code>MySystem.Messages.SomeMessage</code></li> <li>The message is routed by messaging infrastructure to the <code>my_endpoint</code> exchange</li> <li>The message is then routed to the <code>my_endpoint</code> queue</li></ul> <div class="alert alert-info"><b>Note:</b>
If you publish a message before the consumer has been started (and created its configuration), the exchange
<i>MySystem.Messages.SomeMessage</i> will be created. It will not be bound to anything until the consumer starts,
so if you publish to it, the message will just disappear.
</div> <h2 id="queues"><a href="#queues" class="header-anchor">#</a> Queues</h2> <ul><li>Each application you write should use a unique queue name.</li> <li>If you run multiple copies  of your consumer service, they would listen to the same queue (as they are copies).
This would mean you have multiple applications listening to <code>my_endpoint</code> queue
This would result in a 'competing consumer' scenario.  (Which is what you want if you run same service multiple times)</li> <li>If there is an exception from your consumer, the message will be sent to <code>my_endpoint_error</code> queue.</li> <li>If a message is received in a queue that the consumer does not know how to handle, the message will be sent to <code>my_endpoint_skipped</code> queue.</li></ul> <h2 id="design-benefits"><a href="#design-benefits" class="header-anchor">#</a> Design Benefits</h2> <ul><li>Any application can listen to any message and that will not affect any other application that may or may not be listening for that message</li> <li>Any application(s) that bind a group of messages to the same queue will result in the competing consumer pattern.</li> <li>You do not have to concern yourself with anything but what message type to produce and what message type to consume.</li></ul> <h2 id="faq"><a href="#faq" class="header-anchor">#</a> Faq</h2> <ul><li><p>How many messages at a time will be simultaneously processed?</p> <ul><li>Each endpoint you create represents 1 queue.  That queue can receive any number of different message types (based on what you subscribe to it)</li> <li>The configuration of each endpoint you can set the number of consumers with a call to <code>PrefetchCount(x)</code>.</li> <li>This is the total number of consumers for all message types sent to this queue.</li> <li>In MT2, you had to add ?prefetch=X to the Rabbit URL. This is handled automatically now.</li></ul></li> <li><p>Can I have a set number of consumers per message type?</p> <ul><li><p>Yes. This uses middleware.</p> <p><code>x.Consumer(new AutofacConsumerFactory&lt;…&gt;(), p =&gt; p.UseConcurrencyLimit(1)); x.PrefetchCount=16;</code></p> <p>PrefetchCount should be relatively high, a multiple of your concurrency limit for all message types so that RabbitMQ doesn't choke delivery messages due to network delays. Always have a queue ready to receive the message.</p></li></ul></li> <li><p>When my consumer is not running, I do not want the messages to wait in the queue.  How can I do this?</p> <ul><li>There are two ways.  Note that each of these imply you would never use a 'competing consumer' pattern, so make sure that is the case.
<ol><li>Set <code>PurgeOnStartup=true</code> in the endpoint configuration. When the bus starts, it will empty the queue of all messages.</li> <li>Set <code>AutoDelete=true</code> in the endpoint configuration. This causes the queue to be removed when your application stops.</li></ol></li></ul></li> <li><p>How are Retries handled?</p> <ul><li>This is handled by <a href="/MassTransit/usage/transports/middleware.html">middleware</a>. Each endpoint has a <a href="/MassTransit/usage/transports/retry.html">retry policy</a>.</li></ul></li> <li><p>Can I have a different retry policy per each message type?</p> <ul><li>No. This is set at an endpoint level. You would have to have a specific queue per consumer to achieve this.</li></ul></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/usage/transports/rabbitmq.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/11/2019, 3:58:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/MassTransit/usage/configuration.html" class="prev">Configuration</a></span> <span class="next"><a href="/MassTransit/usage/transports/azure-sb.html">Azure Service Bus</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/MassTransit/assets/js/app.507829b3.js" defer></script><script src="/MassTransit/assets/js/6.b9c46cbe.js" defer></script><script src="/MassTransit/assets/js/1.f2cfa088.js" defer></script><script src="/MassTransit/assets/js/110.525aec89.js" defer></script>
  </body>
</html>
